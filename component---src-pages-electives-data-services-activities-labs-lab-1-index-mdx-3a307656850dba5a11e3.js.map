{"version":3,"sources":["webpack:///./src/pages/electives/data-services/activities/labs/lab1/index.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---src-pages-electives-data-services-activities-labs-lab-1-index-mdx-3a307656850dba5a11e3.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/ibm-cloud-architecture/learning-cloudnative-101/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h2>{`Activity description`}</h2>\n    <p>{`In this excercise, you will configure an application to write data to a PostgreSQL database running in the IBM Cloud. This activity will use the following items:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`An instance of a postgress database`}</li>\n      <li parentName=\"ol\">{`A Kubernetes cluster`}</li>\n    </ol>\n    <h3>{`Extra credit`}</h3>\n    <p>{`In the extra credit part of this excercise, you will build an image for the application, push it to the IBM Container Registry, and define your yaml so it pulls the image from the IBM Container Registry. For this activity you will also need:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`An IBM Cloud login`}</li>\n      <li parentName=\"ol\">{`The resource group for your access to the IBM Container Registry`}</li>\n      <li parentName=\"ol\">{`Access to the IBM Container Registry`}</li>\n    </ol>\n    <p><strong parentName=\"p\">{`Note:`}</strong>{` This lab is based on code from `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM-Cloud/clouddatabases-helloworld-kubernetes-examples\"\n      }}>{`https://github.com/IBM-Cloud/clouddatabases-helloworld-kubernetes-examples`}</a>{` We are using the code from the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/IBM-Cloud/clouddatabases-helloworld-kubernetes-examples/tree/node/postgresql\"\n      }}>{`postgres section.`}</a></p>\n    <h2>{`Prerequisites`}</h2>\n    <p>{`See the `}<a parentName=\"p\" {...{\n        \"href\": \"/prerequisites\"\n      }}>{`Prerequisites section`}</a>{` for the prerequisites for this lab.`}</p>\n    <h2>{`Information required to complete this lab`}</h2>\n    <p>{`Write down each of these before you begin this exercise. You must know these values to complete this lab.`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Kubernetes cluster name: `}<br />{`[cluster_name]`}<hr /></li>\n      <li parentName=\"ol\">{`Postgres database name: `}<br />{`[database_name]`}<hr /></li>\n      <li parentName=\"ol\">{`Kubernetes secret to access the database: `}<br />{`[path-to-secret_name]`}<hr /></li>\n    </ol>\n    <h2>{`Activity`}</h2>\n    <h3>{`Add the Kubernetes secret to your cluster`}</h3>\n    <p><strong parentName=\"p\">{`Note:`}</strong>{` If your database uses both public and private endpoints, your public endpoint will be used by default. Therefore, if you want to select the private endpoint, first you will need to create a service key for your database so Kubernetes can use it when binding to the database.`}</p>\n    <p>{`For this lab the key has been created. `}<strong parentName=\"p\">{`Note:`}</strong>{` You should download the `}<inlineCode parentName=\"p\">{`postgress-secret.yaml`}</inlineCode>{` file to the current directory. You’ll bind the database to the Kubernetes cluster by applying a yaml file. Apply the secrets yaml file with the command:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl apply -f postgress-secret.yaml\n`}</code></pre>\n    <p>{`This will create a secret in your Kubernetes cluster using the database’s private endpoint from the key you’ve created above.`}</p>\n    <p>{`Verify that the Kubernetes secret was created in your cluster namespace. Kubernetes uses secrets to store confidential information like the IBM Cloud Identity and Access Management (IAM) API key and the URL that the container uses to gain access. Running the following command, you’ll get the API key for accessing the instance of your Databases for PostgreSQL service that’s provisioned in your account.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl get secrets\n`}</code></pre>\n    <h3>{`Create a yaml file to deploy the application`}</h3>\n    <p>{`Take a look at the yaml file below. Save this file as `}<inlineCode parentName=\"p\">{`clouddb-deployment.yaml`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: icdpostgres-app\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      run: clouddb-demo\n  template:\n    metadata:\n      name: icdpostgres-app\n      labels:\n        run: clouddb-demo\n    spec:\n      containers:\n        - name: cloudpostgres-nodejs-app\n          image: docker.io/ibmcase/icdpg:1.0\n          imagePullPolicy: Always\n          env:\n            - name: BINDING\n              valueFrom:\n                secretKeyRef:\n                  name: binding-postgressql-cloudnative-bootcamp\n                  key: binding\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: cloudpostgres-service\n  labels:\n    run: clouddb-demo\nspec:\n  type: NodePort\n  selector:\n    run: clouddb-demo\n  ports:\n    - protocol: TCP\n      port: 8080\n`}</code></pre>\n    <h3>{`Examine the yaml file`}</h3>\n    <p>{`You should notice several things in this yaml file.`}</p>\n    <p>{`The image is pulled from `}<a parentName=\"p\" {...{\n        \"href\": \"https://hub.docker.com/repository/docker/ibmcase/icdpg\"\n      }}>{`docker hub`}</a>{` Notice the `}<inlineCode parentName=\"p\">{`spec`}</inlineCode>{` section contains the name of the image:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`    spec:\n      containers:\n      - name: cloudpostgres-nodejs-app\n        image: docker.io/ibmcase/icdpg:1.0 \n`}</code></pre>\n    <p>{`Under `}<inlineCode parentName=\"p\">{`secretKeyRef`}</inlineCode>{` section, notice the name `}<inlineCode parentName=\"p\">{`binding-postgressql-cloudnative-bootcamp`}</inlineCode>{` this matches the name of the secret that was generated for the IBM Cloud Databases for PostgreSQL This secret was provided to you in the `}<inlineCode parentName=\"p\">{`postgress-secret.yaml`}</inlineCode>{` file.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`secretKeyRef:\n  name: binding-postgressql-cloudnative-bootcamp \n`}</code></pre>\n    <h3>{`Apply the yaml file`}</h3>\n    <p>{`Deploy the application to your Kubernetes cluster. When you deploy the application, it will automatically be bound to your Kubernetes cluster.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl apply -f clouddb-deployment.yaml\n`}</code></pre>\n    <p>{`Describe the deployment`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl describe deployment icdpostgres-app\n`}</code></pre>\n    <p>{`Check on the pod that was created:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl get pod -l run=clouddb-demo\n`}</code></pre>\n    <p>{`Get the URL for the application. Use the code below to get the URL for the apllication:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl port-forward service/cloudpostgres-service 8080:8080\n`}</code></pre>\n    <p>{`Try the URL from your browser on http://localhost:8080`}</p>\n    <p>{`The clouddatabases-postgresql-helloworld app displays the contents of an examples database. To demonstrate that the app is connected to your service, add some words to the database. The words are displayed as you add them, with the most recently added words displayed first.`}</p>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"45.833333333333336%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB4klEQVQoz21SbU/aUBTmHzldUGkZiihY+gYtpbZgpVA6wKKh6sBMyZZpmDHqoon74Of9jH1YsuwX7Pfs2bm3Y9mWfXhyzr0957nneU5TgqRBkE2ImolVScWW5cHpHcAK9rETDlHvRjzymv9A+AOiUkMq5/Qhz75AP/2OnNJDyW5gMJ6iffgKPiEYTeANjyFQcVarI6taEAmCkoCRZAksMtJUYfIJl59/YPYAyOYTMvI28tUGcrqNzVoTecPFgmojTXdLFReLlQaWKc9Ye1ip+yg6Pqqtl1iv7CSEaSeGFH2D3/mKnDxAse6if3LOpe5GMQy/B7s7hEXn8Pg1x7bTwsKGjMWCgmcUn2+pSBf1hFAk38RyExnJxWpZpelclF2ffItwcXuPq4ePuHl8wtvrD6jshRztwxOM31zS3R3e3z/ibHaNMB5jjVSlEi8M8sCgF2p8dIlkWJ0BoskUo/N3iKcX3NM1+sage120hjHCo1PsU00wGsMOBnhBHhNhsh2GTNkgyR5v9qIjaNTIiM12nyRpWC7pWJGqXB6TubSpkGyZx3RpLvkX2Zxwg5agNgMujZnNcuaj0uygRsTM25Lt8Wa28TnmHH8RsiI2dsFs8A2zyB5gMW84NP1ukled3//dv/gJVlpsQ8oEWywAAAAASUVORK5CYII=')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"Postgress App\",\n        \"title\": \"Postgress App\",\n        \"src\": \"/static/7cf3aa3576e888155ec9878dc32902fc/3cbba/postgressApp.png\",\n        \"srcSet\": [\"/static/7cf3aa3576e888155ec9878dc32902fc/7fc1e/postgressApp.png 288w\", \"/static/7cf3aa3576e888155ec9878dc32902fc/a5df1/postgressApp.png 576w\", \"/static/7cf3aa3576e888155ec9878dc32902fc/3cbba/postgressApp.png 1152w\", \"/static/7cf3aa3576e888155ec9878dc32902fc/b3a2f/postgressApp.png 1305w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n    <h2>{`Extra credit`}</h2>\n    <p>{`In this section you will use the IBM Cloud Registry to store the image. You will build the image but you do not need Docker Desktop. The build will happen on the IBM Cloud.`}</p>\n    <h3>{`Login in to the IBM Cloud from the command line`}</h3>\n    <p>{`Connect to IBM Cloud in the command line tool and follow the prompts to log in.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud login\n`}</code></pre>\n    <p><strong parentName=\"p\">{`Note:`}</strong>{` If you have a federated user ID, use the `}<inlineCode parentName=\"p\">{`ibmcloud login --sso`}</inlineCode>{` command to log in with your single sign on ID.`}</p>\n    <p>{`Make sure you are targeting the correct IBM Cloud resource group of your IBM Cloud Kubernetes Service.`}</p>\n    <p>{`Use the following command to target your cluster resource group if your resource group is other than default.`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud target -g [resource_group_name]\n`}</code></pre>\n    <h3>{`Create a namespace to store your image`}</h3>\n    <p>{`Create your own private image repository in IBM Cloud Container Registry to store your application’s Docker image. Since we want the images to be private, we need to create a namespace, which will create a unique URL to your image repository. `}<strong parentName=\"p\">{`Note:`}</strong>{` Use your initials to make the namespace unique and easier to find.`}</p>\n    <p>{`You can create a namespace with the command: `}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud cr namespace-add [your-initials]-cloud-native\n`}</code></pre>\n    <p>{`You can see a list of all namespaces with:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud cr namespaces\n`}</code></pre>\n    <p>{`Clone the app to your local environment from your terminal using the following command:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`git clone -b node https://github.com/IBM-Cloud/clouddatabases-helloworld-kubernetes-examples.git\ncd clouddatabases-helloworld-kubernetes-examples/postgresql\n`}</code></pre>\n    <p><inlineCode parentName=\"p\">{`cd`}</inlineCode>{` into this newly created directory `}<inlineCode parentName=\"p\">{`clouddatabases-helloworld-kubernetes-examples`}</inlineCode>{`, and `}<inlineCode parentName=\"p\">{`cd`}</inlineCode>{` into the `}<inlineCode parentName=\"p\">{`postgresql`}</inlineCode>{` folder. The code for connecting to the service, and reading from and updating the database can be found in server.js. See Code Structure and the code comments for information on the app’s functions. There’s also a public directory, which contains the html, style sheets and JavaScript for the web app. But, to get the application working, we’ll first need to push the Docker image of this application to our IBM Cloud Container Registry.`}</p>\n    <p>{`Build and push the application’s Docker image to your IBM Cloud Container Registry. We’re calling this container icdpg. `}<strong parentName=\"p\">{`Note:`}</strong>{` There is a period (dot) at the end of the following command.`}</p>\n    <p>{`Check the region where you registry is located in our example we use `}<inlineCode parentName=\"p\">{`us-south`}</inlineCode>{` and the registry hostname is `}<inlineCode parentName=\"p\">{`us.icr.io`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud cr build -t us.icr.io/[your_namespace]/icdpg .\n`}</code></pre>\n    <p>{`After it’s built, you can view the image in container registry using:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`ibmcloud cr images\n`}</code></pre>\n    <p>{`You’ll get something like the following response:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`REPOSITORY                       TAG      DIGEST         NAMESPACE   CREATED       SIZE    SECURITY STATUS\nus.icr.io/[namespace]/icdpg         latest   81c3959ea657   [namespace] 4 hours ago   28 MB   No Issues\n`}</code></pre>\n    <h2>{`Code Structure`}</h2>\n    <h3>{`File\tDescription`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`server.js\tEstablishes a connection to the PostgreSQL database using credentials from BINDING (the name we created in the Kubernetes deployment file to expose the PostgreSQL credentials) and handles create and read operations on the database.`}</li>\n      <li parentName=\"ul\">{`main.js\tHandles user input for a PUT command and parses the results of a GET command to output the contents of the PostgreSQL database.`}</li>\n    </ul>\n    <h2>{`REST - The app uses a PUT and a GET operation:`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`PUT`}</li>\n    </ul>\n    <p>{`— takes user input from main.js\n— uses the client.query method to add the user input to the words table`}</p>\n    <ul>\n      <li parentName=\"ul\">{`GET`}</li>\n    </ul>\n    <p>{`— uses client.query method to retrieve the contents of the words table\n— returns the response of the database command to main.js`}</p>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}