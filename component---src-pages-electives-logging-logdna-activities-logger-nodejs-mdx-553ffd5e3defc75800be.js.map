{"version":3,"sources":["webpack:///./src/pages/electives/logging/logdna/activities/logger/nodejs.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"wPAMaA,G,UAAe,IACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,EACF,8BACD,OAAO,YAACJ,EAAD,eAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,sCACA,sBACE,kBAAIC,WAAW,MAAf,4GAAiI,6BAAGA,WAAW,MAAS,CACpJ,KAAQ,mCADqH,UAInI,oDACA,sBACE,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,mGAAuH,6BAAGA,WAAW,KAAQ,CACzI,KAAQ,uCAD2G,UAIzH,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,yDAA6E,0BAAYA,WAAW,KAAvB,aAA7E,qCAAwK,6BAAGA,WAAW,KAAQ,CAC1L,KAAQ,kHAD4J,aAK5K,uBAAK,gCAAMA,WAAW,OAAU,CAC5B,UAAa,wBADZ,80BAkCL,uDACA,sBACE,kBAAIA,WAAW,MAAf,qBAA0C,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CACpF,UAAa,kBAD4C,gFAKjE,8CACA,sBACE,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,qDACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,mBADI,wDAKvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,wCACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,mBADI,iFAIrB,iBAAGA,WAAW,MAAd,4BACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,IAA3B,sBAGvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,gBACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,yCAKvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,mCACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,6TAMzB,sDACA,sBACE,kBAAIA,WAAW,MAAf,kBACA,kBAAIA,WAAW,MAAf,cAAmC,0BAAYA,WAAW,MAAvB,sCAErC,mBAAU,CACR,UAAa,4BACb,MAAS,CACP,SAAY,WACZ,QAAW,QACX,WAAc,OACd,YAAe,OACf,SAAY,WAPhB,WAUI,gCAAMA,WAAW,QAAW,CAC5B,UAAa,qCACb,MAAS,CACP,cAAiB,sBACjB,SAAY,WACZ,OAAU,IACV,KAAQ,IACR,gBAAmB,ooBACnB,eAAkB,QAClB,QAAW,YAnBjB,OAsBA,+BAAKA,WAAW,QAAW,CACvB,UAAa,0BACb,IAAO,mBACP,MAAS,mBACT,IAAO,sEACP,OAAU,CAAC,2EAA4E,2EAA4E,4EAA6E,6EAChP,MAAS,oCACT,MAAS,CACP,MAAS,OACT,OAAU,OACV,OAAU,IACV,cAAiB,SACjB,SAAY,WACZ,IAAO,IACP,KAAQ,KAEV,QAAW,UAtCf,WA6CJJ,EAAWK,gBAAiB","file":"component---src-pages-electives-logging-logdna-activities-logger-nodejs-mdx-553ffd5e3defc75800be.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/ibm-cloud-architecture/learning-cloudnative-101/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h3>{`Prerequisite`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Configure the LogDNA Agent on a kubernetes cluster, you can use one of the labs in this bootcamp located `}<a parentName=\"li\" {...{\n          \"href\": \"/monitoring/logdna/#activities\"\n        }}>{`here`}</a></li>\n    </ul>\n    <h2>{`Logging library in Node.js`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`There are multiple logging libraries available for Node.js, on this example we are going to use `}<a parentName=\"p\" {...{\n            \"href\": \"https://www.npmjs.com/package/pino\"\n          }}>{`pino`}</a></p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`You can instrument a Node.js express web server using `}<inlineCode parentName=\"p\">{`pino-http`}</inlineCode>{` the example is located in GitHub `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/ibm-cloud-architecture/learning-cloudnative-101/blob/master/examples/logging/nodejs/app.js\"\n          }}>{`app.js`}</a></p>\n      </li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const express = require('express')\nconst isProduction = process.env.NODE_ENV === 'production'\nconst formatters = {\n    level(label, number) {\n        return { level: label }\n    }\n}\nconst pino = require('pino-http')({\n    prettyPrint: isProduction ? false : true,\n    level: isProduction ? 'error' : 'info',\n    formatters: formatters,\n    messageKey: 'message'\n})\nconst PORT = process.env.PORT || 8080;\n\nvar app = express()\n\napp.use(pino)\n\napp.get('/', function (req, res) {\n    req.log.info('this is a info log message')\n    res.send('Hello World')\n})\napp.get('/error', function (req, res, next) {\n    req.log.error('Internal error with request /error')\n    res.status(503).send('Internal error')\n})\n\napp.listen(PORT, () => {\n    console.log(\\`Listening on PORT=\\${PORT} and isProduction=\\${isProduction}\\`);\n})\n`}</code></pre>\n    <h2>{`Deploy the sample application`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Create a namespace`}<pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl create deployment my-app --image=ibmcase/nodejs-logging-example\n`}</code></pre></li>\n    </ul>\n    <h2>{`Test the application`}</h2>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Expose application web service on local port 8080`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`kubectl port-forward deployment/my-app 8080:8080\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Send http request to the web service`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-shell\"\n          }}>{`while true; do sleep 1; curl http://localhost:8080/error -s -w \"\\\\n\"; done\n`}</code></pre>\n        <p parentName=\"li\">{`  Output looks like this`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`Internal error\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Get the logs`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl logs deployment/my-app -f\n`}</code></pre>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`The error line printend is JSON`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-json\"\n          }}>{`{\"level\":\"error\",\"time\":1591588923197,\"pid\":25,\"hostname\":\"my-app-78647889d5-nv4rt\",\"req\":{\"id\":2,\"method\":\"GET\",\"url\":\"/error\",\"headers\":{\"host\":\"localhost:8080\",\"user-agent\":\"curl/7.64.1\",\"accept\":\"*/*\"},\"remoteAddress\":\"::ffff:127.0.0.1\",\"remotePort\":48458},\"message\":\"Internal error with request /error\"}\n`}</code></pre>\n      </li>\n    </ul>\n    <h2>{`Find the JSON logs in LogDNA`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Open the Views`}</li>\n      <li parentName=\"ul\">{`Search for `}<inlineCode parentName=\"li\">{`container:nodejs-logging-example`}</inlineCode></li>\n    </ul>\n    <span {...{\n      \"className\": \"gatsby-resp-image-wrapper\",\n      \"style\": {\n        \"position\": \"relative\",\n        \"display\": \"block\",\n        \"marginLeft\": \"auto\",\n        \"marginRight\": \"auto\",\n        \"maxWidth\": \"1152px\"\n      }\n    }}>{`\n      `}<span parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-background-image\",\n        \"style\": {\n          \"paddingBottom\": \"54.513888888888886%\",\n          \"position\": \"relative\",\n          \"bottom\": \"0\",\n          \"left\": \"0\",\n          \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfElEQVQoz42SWU7DMBCGfQnEVjuJ4y0hix23pU6A0FAkyiIqBAX1hSeEuALPIHEKzsokgAQFJD6NJWfsGc/MHySlzJLEZarWkUkTkVpjR8+X82o4yHWudS6k6HVg3FsCCcFOLqZD50pXVmVljLG2b01hrTWmiKIYY+z9ASoS/ng3ybYkpPZ9D3/Pj8mfkW3wxtp6M61uHq4YZx7x/MCHFO/2A7L0iVZWN48b8/qyODpvVASoH5d+hxCC4GLCvMm4uH+677u+4Nzz/xMLpflIhf6BVVwqFUnoF3eQD/Cnka6cztWOnYC1wdDjdeOKLIklT/Ug1iMVbzERQfetBcH7BkaOCSQImORMhDAaGlIUUDq7nbvagabbu266OBuUw3o61rbQ1ugCpDNwtH86Ppgdpnme9fMoUTBd0BgxGo6G27gtpxUmFBQeCKhP8Bd6OGABZRSq3gDWYW2CF5XVTpamO+Wg3hs1tYNnwpABvAM2cRyDBvAj8s6nlAo7oOc3MGdlMNmTkX8AAAAASUVORK5CYII=')\",\n          \"backgroundSize\": \"cover\",\n          \"display\": \"block\"\n        }\n      }}></span>{`\n  `}<img parentName=\"span\" {...{\n        \"className\": \"gatsby-resp-image-image\",\n        \"alt\": \"json-logs-nodejs\",\n        \"title\": \"json-logs-nodejs\",\n        \"src\": \"/static/59c01581470828c33cfc5a842b84c0cc/3cbba/json-logs-nodejs.png\",\n        \"srcSet\": [\"/static/59c01581470828c33cfc5a842b84c0cc/7fc1e/json-logs-nodejs.png 288w\", \"/static/59c01581470828c33cfc5a842b84c0cc/a5df1/json-logs-nodejs.png 576w\", \"/static/59c01581470828c33cfc5a842b84c0cc/3cbba/json-logs-nodejs.png 1152w\", \"/static/59c01581470828c33cfc5a842b84c0cc/92c65/json-logs-nodejs.png 1216w\"],\n        \"sizes\": \"(max-width: 1152px) 100vw, 1152px\",\n        \"style\": {\n          \"width\": \"100%\",\n          \"height\": \"100%\",\n          \"margin\": \"0\",\n          \"verticalAlign\": \"middle\",\n          \"position\": \"absolute\",\n          \"top\": \"0\",\n          \"left\": \"0\"\n        },\n        \"loading\": \"lazy\"\n      }}></img>{`\n    `}</span>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}