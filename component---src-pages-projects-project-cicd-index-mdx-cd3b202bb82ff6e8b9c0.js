(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{"2yob":function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return l})),a.d(t,"default",(function(){return b}));var i=a("wx14"),n=a("zLVn"),o=(a("q1tI"),a("7ljp")),r=a("013z"),l=(a("qKvR"),{}),c={_frontmatter:l},s=r.a;function b(e){var t=e.components,a=Object(n.a)(e,["components"]);return Object(o.b)(s,Object(i.a)({},c,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",null,"Challenge"),Object(o.b)("p",null,"You are provided with the challenge to implement a demo that shows best practices for DevOps.\nImplement Continous Integration and Continous Deployment for an Application on Kubernetes."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Git repository with application code and Dockerfile, Developers have access to this git repository"),Object(o.b)("li",{parentName:"ul"},"Git repository with pipeline manifest files (ie yamls) files, Operators have access to this repository"),Object(o.b)("li",{parentName:"ul"},"Git repository with application manifest (ie yaml) files, automation only have access to this repository")),Object(o.b)("h2",null,"Specifications"),Object(o.b)("span",{className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"818px"}},"\n      ",Object(o.b)("span",Object(i.a)({parentName:"span"},{className:"gatsby-resp-image-background-image",style:{paddingBottom:"31.59722222222222%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABLElEQVQY011RS07DMBDNZTkCN+AOHIItYgEbFlUlyKJsWBQqmqRq/g12fo5/eYzdn8RIT54ZzxvPPAdwNltIKWGNwUwhLw8oNjEsRS6nlPKnL51nnG0mnr2EFkYbBExb9ARNJCEmKK1QpRWi9Q7aaP+QIggqbtSR7eqstVRLYCt8RjneFjuIMERwlxg85ERqGapDjbIoIKYJbdeCc440y2HHHq95h9sfjW4UiMMl6v0O/TSjWd0gi55BVKh0j2C5TbEpGxglwdsOv4z7qdwU4ziiHwbISSBjLRZR5ieMv9foOKMNDJJkC9bUfuWeBgn0OECR4+wplLh/bMkz0LSiMSfQeq6pcE209o3Od1IqOq2XwCHw4p5k/fjieHnPjxKT2u4Dzrh+xP/89c7ZHxOmzVvIViJ9AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}})),"\n  ",Object(o.b)("img",Object(i.a)({parentName:"span"},{className:"gatsby-resp-image-image",alt:"overview-diagram",title:"overview-diagram",src:"/static/e0f59cda603cd30cfc3a5138da9d879c/96d67/tekton-argocd.png",srcSet:["/static/e0f59cda603cd30cfc3a5138da9d879c/7fc1e/tekton-argocd.png 288w","/static/e0f59cda603cd30cfc3a5138da9d879c/a5df1/tekton-argocd.png 576w","/static/e0f59cda603cd30cfc3a5138da9d879c/96d67/tekton-argocd.png 818w"],sizes:"(max-width: 818px) 100vw, 818px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy"})),"\n    "),Object(o.b)("h3",null,"Code Git Repository"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-code"}),"Git repository with application code")),Object(o.b)("li",{parentName:"ul"},"Create a new git repository using this repo as ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-code/generate"}),"template")),Object(o.b)("li",{parentName:"ul"},"Use the ",Object(o.b)("inlineCode",{parentName:"li"},"Dockerfile")," on the root of the repository to build a container image")),Object(o.b)("h3",null,"Infra Git Repository"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-infra"}),"Git repository with application manifest")),Object(o.b)("li",{parentName:"ul"},"Create a new git repository using this repo as ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/ibm-cloud-architecture/tutorial-tekton-argocd-infra/generate"}),"template")),Object(o.b)("li",{parentName:"ul"},"The directory ",Object(o.b)("inlineCode",{parentName:"li"},"ocp/yamls")," contains the application manifest files")),Object(o.b)("h3",null,"Pipeline Git Repository"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Create new repository to store pipeline resources"),Object(o.b)("li",{parentName:"ul"},"Use the ServiceAccount ",Object(o.b)("inlineCode",{parentName:"li"},"pipeline")),Object(o.b)("li",{parentName:"ul"},"Use the following guide to create a Pipeline, Tasks, and secret:",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Create a pipeline, tasks, secrets on the target namespace"),Object(o.b)("li",{parentName:"ul"},"Git clone the source code from the App repo"),Object(o.b)("li",{parentName:"ul"},"Build a container image using the ",Object(o.b)("inlineCode",{parentName:"li"},"Dockerfile")," on the repo"),Object(o.b)("li",{parentName:"ul"},"Tag the image using the 7 first characters of the git hash corresponding to last git commit"),Object(o.b)("li",{parentName:"ul"},"Push the container image into the internal image registry on the same namespace"),Object(o.b)("li",{parentName:"ul"},"Git clone the Infra git repo"),Object(o.b)("li",{parentName:"ul"},"Update the image on the deployment yaml with the new image id that has the tag with value of the git commit"),Object(o.b)("li",{parentName:"ul"},"Git commit the changes"),Object(o.b)("li",{parentName:"ul"},"Git push the changes to the infra git repo, this should trigger argocd to pickup any changes from the infra repo.")))),Object(o.b)("h2",null,"Hints"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"The secret contains the git username and token with permission ",Object(o.b)("inlineCode",{parentName:"li"},"repo")," that gives write access to the git infra repository"),Object(o.b)("li",{parentName:"ul"},"OpenShift 4 comes with an internal image registry you can push from a Tekton task"),Object(o.b)("li",{parentName:"ul"},"The image registry url contains the service name, port, namespace, image name and tag",Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),"image-registry.openshift-image-registry.svc:5000/my-namespace-app/image-name:my-tag\n"))),Object(o.b)("li",{parentName:"ul"},"The image registry only handles ssl/https connections, but it uses a self sign certificate"),Object(o.b)("li",{parentName:"ul"},"You need to ignore TLS-Verify to be able to succesfully push and ignore ssl errors for example using buildah set the flag ",Object(o.b)("inlineCode",{parentName:"li"},'--tls-verify="false"'))),Object(o.b)("h2",null,"Extra Credit"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Make the pipeline to run automatically every time new code gets pushed to the Code git repository",Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"Configure a Github Webhook using the new ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"https://github.com/tektoncd/triggers"}),"Tekton Triggers")," listener and bindings")))),Object(o.b)("h2",null,"Solution"),Object(o.b)("p",null,"Here is one implementation as a ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"./solution"}),"solution")))}b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-projects-project-cicd-index-mdx-cd3b202bb82ff6e8b9c0.js.map