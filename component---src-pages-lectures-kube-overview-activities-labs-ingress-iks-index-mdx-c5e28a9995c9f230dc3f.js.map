{"version":3,"sources":["webpack:///./src/pages/lectures/kube-overview/activities/labs/ingress-iks/index.mdx"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"wPAMaA,G,UAAe,IACtBC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,EACF,8BACD,OAAO,YAACJ,EAAD,eAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,4BAAW,6BAAGC,WAAW,KAAQ,CAC7B,KAAQ,gDADD,0BAAX,0PAGA,uCACA,sBACE,kBAAIA,WAAW,MAAf,iEAAsF,sBAAQA,WAAW,MAAnB,QAAtF,yFAAyN,0BAAYA,WAAW,MAAvB,cACzN,kBAAIA,WAAW,MAAf,6CACA,kBAAIA,WAAW,MAAf,qCAA0D,0BAAYA,WAAW,MAAvB,WAA1D,cAA6H,0BAAYA,WAAW,MAAvB,kDAA7H,aAEF,oCACA,+EAA8D,6BAAGA,WAAW,KAAQ,CAChF,KAAQ,2FADkD,4BAA9D,wGAGA,uDACA,qBAAG,kBAAIA,WAAW,KAAf,uCAAH,oEACA,sBACE,kBAAIA,WAAW,MAAf,2FACA,kBAAIA,WAAW,MAAf,oEAEF,iGAAgF,6BAAGA,WAAW,KAAQ,CAClG,KAAQ,+EADoE,sCAAhF,8FAE8I,sBAAQA,WAAW,KAAnB,yBAC9I,sBACE,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,6CAAiE,0BAAYA,WAAW,KAAvB,QAAjE,+JAAiR,0BAAYA,WAAW,KAAvB,wCAAjR,wBACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,oGAKvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,2BAA+C,0BAAYA,WAAW,KAAvB,WAA/C,+GACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,6IAMvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,iDAAqE,0BAAYA,WAAW,KAAvB,WAArE,KACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,6BAIrB,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,IAA3B,yDAIrB,iBAAGA,WAAW,MAAd,KAAyB,sBAAQA,WAAW,KAAnB,OAAzB,iDAAkH,6BAAGA,WAAW,KAAQ,CACpI,KAAQ,gDADsG,4BAAlH,gGAIF,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,gFACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,iHAMvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,kCACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,uXAsBvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,4BACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,+BAKvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,+BACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,8BAIrB,iBAAGA,WAAW,MAAd,8BACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,kDAKvB,kBAAIA,WAAW,MACb,iBAAGA,WAAW,MAAd,oCACA,mBAAKA,WAAW,MAAK,gCAAMA,WAAW,OAAU,CAC5C,UAAa,kBADI,0DAU7BJ,EAAWK,gBAAiB","file":"component---src-pages-lectures-kube-overview-activities-labs-ingress-iks-index-mdx-c5e28a9995c9f230dc3f.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/travis/build/ibm-cloud-architecture/learning-cloudnative-101/node_modules/gatsby-theme-carbon/src/templates/Default.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`The `}<a parentName=\"p\" {...{\n        \"href\": \"https://www.ibm.com/cloud/container-service\"\n      }}>{`IBM Kubernetes service`}</a>{` free clusters consist of a single worker node with 2 CPU and 4 GB of memory for experimenting with Kubernetes. Unlike the fee-based service, these clusters do not include capabilities for application load balancing using ingress out-of-the-box. `}</p>\n    <h2>{`Prerequisites`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Free IBM Kubernetes Cluster (IKS) - upgrade your account from `}<strong parentName=\"li\">{`Lite`}</strong>{` plan to create one. In the example commands, weâ€™ll assume that this cluster is named `}<inlineCode parentName=\"li\">{`mycluster`}</inlineCode></li>\n      <li parentName=\"ul\">{`kubectl - match your cluster API version `}</li>\n      <li parentName=\"ul\">{`Log in to IBM Cloud and configure `}<inlineCode parentName=\"li\">{`kubectl`}</inlineCode>{` using the `}<inlineCode parentName=\"li\">{`ibmcloud ks cluster config --cluster mycluster`}</inlineCode>{` command`}</li>\n    </ul>\n    <h2>{`Components`}</h2>\n    <p>{`On the IKS cluster, you will install helm charts for a `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/nginxinc/kubernetes-ingress/tree/release-1.7/deployments/helm-chart\"\n      }}>{`nginx ingress controller`}</a>{` from NGINX. This lab already provides the templated yaml files so there is no need to use helm cli.`}</p>\n    <h2>{`Set up the ingress controller`}</h2>\n    <p><em parentName=\"p\">{`Only do this on a free IKS instance`}</em>{` These steps assume facts that only apply to free IKS instances:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`a single worker where the cluster administrator can create pods that bind to host ports`}</li>\n      <li parentName=\"ul\">{`no pre-existing ingress controller or application load balancer`}</li>\n    </ul>\n    <p>{`Using the following steps with a paid instance can cause issues. See the `}<a parentName=\"p\" {...{\n        \"href\": \"https://cloud.ibm.com/docs/containers?topic=containers-cs_network_planning\"\n      }}>{`IBM Cloud containers documentation`}</a>{` for information on exposing applications with the ingress/alb services for paid clusters. `}<strong parentName=\"p\">{`You have been warned`}</strong></p>\n    <ol>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Install the NGINX ingress controller with `}<inlineCode parentName=\"p\">{`helm`}</inlineCode>{` using a daemonset and no service resource (which will result in a single pod that binds to ports 80 and 443 on the worker node and will skip creation of a `}<inlineCode parentName=\"p\">{`ClusterIP, LoadBalancer, or NodePort`}</inlineCode>{` for the daemonset).`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl apply -f https://cloudnative101.dev/yamls/ingress-controller/iks-ingress-v1.7.1.yaml\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`You can use free domain `}<inlineCode parentName=\"p\">{`.nip.io`}</inlineCode>{` to get a domain name using one of the IP Address of your worker nodes. Run this command to set your DOMAIN`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`export DOMAIN=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"ExternalIP\")].address}').nip.io\necho $DOMAIN\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`You can test the ingress controller using the `}<inlineCode parentName=\"p\">{`$DOMAIN`}</inlineCode>{`:`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`curl -I http://$DOMAIN\n`}</code></pre>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`HTTP/1.1 404 Not Found\nServer: nginx/1.17.10\n...\n`}</code></pre>\n        <p parentName=\"li\">{`A `}<strong parentName=\"p\">{`404`}</strong>{` is expected at this point because unlike the `}<a parentName=\"p\" {...{\n            \"href\": \"https://github.com/kubernetes/ingress-nginx\"\n          }}>{`kubernetes nginx ingress`}</a>{`, the NGINX version of the ingress controller does not create a default backend deployment.`}</p>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`To use the ingress controller deploy a sample application, expose a service.`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl create deployment web --image=bitnami/nginx\nkubectl expose deployment web --name=web --port 8080\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Now create an Ingress resource`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`cat <<EOF | kubectl apply -f -\napiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: web\n  labels:\n    app: web\nspec:\n  rules:\n    - host: web.$DOMAIN\n      http:\n        paths:\n          - path: /\n            backend:\n              serviceName: web\n              servicePort: 8080\nEOF\necho \"Access your web app at http://web.$DOMAIN\"\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`List the created ingress`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl get ingress web\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Access your web application`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`curl http://web.$DOMAIN\n`}</code></pre>\n        <p parentName=\"li\">{`The output prints the html`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-html\"\n          }}>{`<p><em>Thank you for using nginx.</em></p>\n`}</code></pre>\n      </li>\n      <li parentName=\"ol\">\n        <p parentName=\"li\">{`Delete all the resources created`}</p>\n        <pre parentName=\"li\"><code parentName=\"pre\" {...{\n            \"className\": \"language-bash\"\n          }}>{`kubectl delete deployment,svc,ingress -l app=web\n`}</code></pre>\n      </li>\n    </ol>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}