{"componentChunkName":"component---src-pages-lectures-continuous-deployment-activities-index-mdx","path":"/lectures/continuous-deployment/activities/","result":{"pageContext":{"frontmatter":{"title":"ArgoCD Lab","description":"Lab for continuous delivery using ArgoCD"},"relativePagePath":"/lectures/continuous-deployment/activities/index.mdx","titleType":"page","MdxNode":{"id":"ea844d40-9e03-5e00-a5a9-15790ed4c238","children":[],"parent":"ac932a84-c0ea-5a70-93c9-92dcc01ab11f","internal":{"content":"---\ntitle: ArgoCD Lab\ndescription: Lab for continuous delivery using ArgoCD\n---\n\n<Tabs>\n<Tab label=\"OpenShift\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    oc new-project argocd\n    ```\n- Install ArgoCD as follows.\n    ```\n    oc apply --filename https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argocd-operator.yaml\n    ```\n- When installing the tutorial, make sure you wait until the argocd-operator is finished before installing the argocd-cr..or it will fail. You can do this:\n    ```bash\n    oc get ClusterServiceVersion -n argocd\n    NAME                                   DISPLAY                        VERSION   REPLACES   PHASE\n    argocd-operator.v0.0.8                 Argo CD                        0.0.8                Succeeded\n    ```\n    and wait for the \"succeeded\" to come up before proceeding.\n    ```\n    oc apply --filename https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argocd-cr.yaml\n    ```\n    and wait for the argocd server Pod to be running\n    ```\n    oc get pods -n argocd -l app.kubernetes.io/name=example-argocd-server\n    ```\n    ```\n    NAME                                     READY   STATUS    RESTARTS   AGE\n    example-argocd-server-57c4fd5c45-zf4q6   1/1     Running   0          115s\n    ```\n- Install the `argocd` CLI, for example on OSX use brew\n    ```bash\n    brew tap argoproj/tap\n    brew install argoproj/tap/argocd\n    ```\n- Set an environment variable `ARGOCD_URL` using the `EXTERNAL-IP`\n    ```bash\n    export ARGOCD_NAMESPACE=\"argocd\"\n    export ARGOCD_SERVER=$(oc get route example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.spec.host}')\n    export ARGOCD_URL=\"https://$ARGOCD_SERVER\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    echo ARGOCD_SERVER=$ARGOCD_SERVER\n    ```\n\n## Deploying the app\n\n- Login into the UI.\n    ```bash\n    open $ARGOCD_URL\n    ```\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    oc get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `openshift`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service route\n    ```\n    oc get route\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                 HOST/PORT                                     PATH   SERVICES                       PORT   TERMINATION   WILDCARD\n    cloudnative-sample   cloudnative-sample-default.apps-crc.testing          cloudnativesampleapp-service   9080                 None\n    ```\n- Set an environment variable `APP_URL` using the `EXTERNAL-IP`\n    ```\n    export APP_URL=\"http://$(oc get route cloudnative-sample -o jsonpath='{.status.ingress[0].host}')\"\n    echo ARGOCD_SERVER=$APP_URL\n    ```\n- Access the url using `curl`\n    ```\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## Using the ArgoCD CLI\n\n- Login using the cli.\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    export ARGOCD_PASSWORD=$(oc get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d)\n    echo $ARGOCD_PASSWORD\n    ```\n- Now login as follows.\n    ```bash\n    argocd login --username admin --password $ARGOCD_PASSWORD $ARGOCD_SERVER\n    ```\n    ```\n    WARNING: server certificate had error: x509: cannot validate certificate for 10.97.240.99 because it doesn't contain \n    any IP SANs. Proceed insecurely (y/n)? y\n\n    'admin' logged in successfully\n    Context 'example-argocd-server-argocd.apps-crc.testing' updated\n    ```\n- List the applications\n    ```bash\n    argocd app list\n    ```\n    ```\n    NAME    CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                                     PATH   TARGET\n    sample  https://kubernetes.default.svc  default    default  Synced  Healthy  <none>      <none>      https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy  openshift  HEAD\n    ```\n- Get application details\n    ```bash\n    argocd app get sample\n    ```\n    ```\n    Name:               sample\n    Project:            default\n    Server:             https://kubernetes.default.svc\n    Namespace:          default\n    URL:                https://10.97.240.99/applications/sample\n    Repo:               https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy\n    Target:             HEAD\n    Path:               openshift\n    SyncWindow:         Sync Allowed\n    Sync Policy:        <none>\n    Sync Status:        Synced to HEAD (9684037)\n    Health Status:      Healthy\n\n    GROUP  KIND        NAMESPACE  NAME                             STATUS  HEALTH   HOOK  MESSAGE\n        Service     default    cloudnativesampleapp-service     Synced  Healthy        service/cloudnativesampleapp-service created\n    apps   Deployment  default    cloudnativesampleapp-deployment  Synced  Healthy        deployment.apps/cloudnativesampleapp-deployment created\n    ```\n- Show application deployment history\n    ```bash\n    argocd app history sample\n    ```\n    ```\n    ID  DATE                           REVISION\n    0   2020-02-12 21:10:32 -0500 EST  HEAD (9684037)\n    ```\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n<Tab label=\"IKS\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    kubectl create namespace argocd\n    export ARGOCD_NAMESPACE=argocd\n    ```\n- Create RBAC resources\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/service_account.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role_binding.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argo-clusteradmin.yaml\n    ```\n\n- Install CRDs\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_applications_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_appprojects_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocdexports_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocds_crd.yaml\n    ```\n    Verify CRDs\n    ```bash\n    kubectl get crd -n argocd\n    ```\n    ```\n    NAME                        CREATED AT\n    applications.argoproj.io    2020-05-15T02:05:55Z\n    appprojects.argoproj.io     2020-05-15T02:05:56Z\n    argocdexports.argoproj.io   2020-05-15T02:08:21Z\n    argocds.argoproj.io         2020-05-15T02:08:21Z\n    ```\n- Deploy Operator\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/operator.yaml\n    ```\n- Deploy ArgoCD CO\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/examples/argocd-lb.yaml\n    ```\n    Verify that ArgoCD Pods are running\n    ```bash\n    kubectl get pods -n argocd\n    ```\n    ```\n    NAME                                                     READY   STATUS    RESTARTS   AGE\n    argocd-operator-5f7d8cf7d8-486vn                         1/1     Running   0          3m46s\n    example-argocd-application-controller-7dc5fcb75d-xkk5h   1/1     Running   0          2m3s\n    example-argocd-dex-server-bb9df96cb-ndmhl                1/1     Running   0          2m3s\n    example-argocd-redis-756b6764-sb2gt                      1/1     Running   0          2m3s\n    example-argocd-repo-server-75944fcf87-zmh48              1/1     Running   0          2m3s\n    example-argocd-server-747b684c8c-xhgl9                   1/1     Running   0          2m3s\n    ```\n    Verify that the other ArgoCD resources are created\n    ```\n    kubectl get cm,secret,svc,deploy -n argocd\n    ```\n- List the argocd-server service\n    ```bash\n    kubectl get svc example-argocd-server -n argocd\n    ```\n\n- From the script, the Argo Server service has a `type` of `LoadBalancer`. If the `ExternalIP` is in a `pending` state, then there is no loadBalancer for your cluster, so we only need the the ArgoCD server's `NodePort`. Otherwise use the `ExternalIP` and `NodePort` to access Argo.\n    ```\n    NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE\n    example-argocd-server   LoadBalancer   10.105.73.245   <pending>   80:31138/TCP,443:31932/TCP   5m3s\n    ```\n\n- To access the service we need the `Node's External IP` and the `NodePort`. Let's set an environment variable `ARGOCD_URL` with `NODE_EXTERNAL_IP`:`NodePort`.\n    ```bash\n    export NODE_EXTERNAL_IP=\"$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"ExternalIP\")].address}')\"\n    export ARGOCD_NODEPORT=\"$(kubectl get svc example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.spec.ports[0].nodePort}')\"\n    export ARGOCD_URL=\"https://$NODE_EXTERNAL_IP:$ARGOCD_NODEPORT\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    ```\n\n- If you can't access the NodePort from your computer and only http/80 then edit the argocd-server and add the flag `--insecure`\n    ```bash\n    kubectl edit -n argocd deployment example-argocd-server\n    ```\n    Use the kube api to proxy into the argocd server using `kubectl port-forward`\n    ```\n    kubectl port-forward service/example-argocd-server 8080:80 -n argocd\n    ```\n    Then you can access the argocd server locally on port 8080 [http://localhost:8080](http://localhost:8080)\n\n## Deploying the app\n\n- Login using the Browser into the UI using `$ARGOCD_URL` or `localhost:8080` if using port-forward\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `kubernetes`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service service\n    ```bash\n    kubectl get svc cloudnativesampleapp-service\n    ```\n    It will have the `NodePort` for the application. In this case, it is `30499`. \n    ```\n    NAME                           TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\n    cloudnativesampleapp-service   NodePort   172.21.118.165   <none>        9080:30499/TCP   20s\n    ```\n- Set an environment variable `APP_URL` using the `Node's IP` and `NodePort` values\n    ```bash\n    export APP_NODE_PORT=\"$(kubectl get svc cloudnativesampleapp-service -n default -o jsonpath='{.spec.ports[0].nodePort}')\"\n    export APP_URL=\"$NODE_EXTERNAL_IP:$APP_NODE_PORT\"\n    echo Application=$APP_URL\n    ```\n- Access the url using `curl`\n    ```bash\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n<Tab label=\"Minikube\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n- Install the `argocd` CLI, for example on OSX use brew\n    ```bash\n    brew tap argoproj/tap\n    brew install argoproj/tap/argocd\n    ```\n\n- Remember to have minikube tunnel running in another terminal\n    ```bash\n    minikube tunnel\n    ```\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    kubectl create namespace argocd\n    ```\n- Create RBAC resources\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/service_account.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role_binding.yaml\n    ```\n    Create ClusterRoleBinding for `cluster-admin` role for `sa` `argocd-application-controller` in namespace `argocd`\n    ```bash\n    cat <<'EOF' | kubectl create -f -\n    apiVersion: rbac.authorization.k8s.io/v1\n    kind: ClusterRoleBinding\n    metadata:\n      labels:\n        app.kubernetes.io/component: application-controller\n        app.kubernetes.io/name: argocd-application-controller\n        app.kubernetes.io/part-of: argocd\n      name: argocd-application-controller\n    roleRef:\n      apiGroup: rbac.authorization.k8s.io\n      kind: ClusterRole\n      name: cluster-admin\n    subjects:\n      - kind: ServiceAccount\n        name: argocd-application-controller\n        namespace: argocd\n    EOF\n    ```\n- Install CRDs\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_applications_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_appprojects_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocdexports_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocds_crd.yaml\n    ```\n    Verify CRDs\n    ```bash\n    kubectl get crd -n argocd\n    ```\n    ```\n    NAME                        CREATED AT\n    applications.argoproj.io    2020-05-15T02:05:55Z\n    appprojects.argoproj.io     2020-05-15T02:05:56Z\n    argocdexports.argoproj.io   2020-05-15T02:08:21Z\n    argocds.argoproj.io         2020-05-15T02:08:21Z\n    ```\n- Deploy Operator\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/operator.yaml\n    ```\n- Deploy ArgoCD CO\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/examples/argocd-lb.yaml\n    ```\n    Verify that ArgoCD Pods are running\n    ```bash\n    kubectl get pods -n argocd\n    ```\n    ```\n    NAME                                                     READY   STATUS    RESTARTS   AGE\n    argocd-operator-5f7d8cf7d8-486vn                         1/1     Running   0          3m46s\n    example-argocd-application-controller-7dc5fcb75d-xkk5h   1/1     Running   0          2m3s\n    example-argocd-dex-server-bb9df96cb-ndmhl                1/1     Running   0          2m3s\n    example-argocd-redis-756b6764-sb2gt                      1/1     Running   0          2m3s\n    example-argocd-repo-server-75944fcf87-zmh48              1/1     Running   0          2m3s\n    example-argocd-server-747b684c8c-xhgl9                   1/1     Running   0          2m3s\n    ```\n    Verify that the other ArgoCD resources are created\n    ```\n    kubectl get cm,secret,svc,deploy -n argocd\n    ```\n- Expose the ArgoCD Server service as a NodePort.\n    ```bash\n    kubectl expose deployment.apps/example-argocd-server --type=\"NodePort\" --port 8080 --name=argo-nodeport -n argocd  \n    ```\n- List the argocd-server service\n    ```bash\n    kubectl get svc example-argocd-server -n argocd\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\n    example-argocd-server   LoadBalancer   172.21.106.88   <pending>     80:32010/TCP,443:31861/TCP   111m\n    ```\n- Set an environment variable `ARGOCD_URL` using the `EXTERNAL-IP`\n    ```bash\n    export ARGOCD_NAMESPACE=argocd\n    export ARGOCD_SERVER=\"$(kubectl get svc example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\"\n    export ARGOCD_URL=\"https://$ARGOCD_SERVER\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    echo ARGOCD_SERVER=$ARGOCD_SERVER\n    ```\n\n## Deploying the app\n\n- Login into the UI.\n    ```bash\n    open $ARGOCD_URL\n    ```\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `kubernetes`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service service\n    ```bash\n    kubectl get svc cloudnativesampleapp-service\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                           TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)          AGE\n    cloudnativesampleapp-service   NodePort       10.109.242.212   10.109.242.212   9080:31905/TCP   13m\n    ```\n- Set an environment variable `APP_URL` using the `EXTERNAL-IP` and `NodePort` values\n    ```bash\n    export APP_URL=\"$(minikube service --url cloudnativesampleapp-service -n default)\"\n    echo APP_URL=$APP_URL\n    ```\n- Access the url using `curl`\n    ```bash\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## Using the ArgoCD CLI\n\n- Login using the cli.\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    export ARGOCD_PASSWORD=$(kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d)\n    echo $ARGOCD_PASSWORD\n    ```\n- Now login as follows.\n    ```bash\n    argocd login --username admin --password $ARGOCD_PASSWORD $ARGOCD_SERVER\n    ```\n    ```\n    WARNING: server certificate had error: x509: cannot validate certificate for 10.97.240.99 because it doesn't contain \n    any IP SANs. Proceed insecurely (y/n)? y\n\n    'admin' logged in successfully\n    Context '10.105.73.245' updated\n    ```\n- List the applications\n    ```bash\n    argocd app list\n    ```\n    ```\n    NAME    CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                                     PATH   TARGET\n    sample  https://kubernetes.default.svc  default    default  Synced  Healthy  <none>      <none>      https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy  kubernetes  HEAD\n    ```\n- Get application details\n    ```bash\n    argocd app get sample\n    ```\n    ```\n    Name:               sample\n    Project:            default\n    Server:             https://kubernetes.default.svc\n    Namespace:          default\n    URL:                https://10.97.240.99/applications/sample\n    Repo:               https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy\n    Target:             HEAD\n    Path:               kubernetes\n    SyncWindow:         Sync Allowed\n    Sync Policy:        <none>\n    Sync Status:        Synced to HEAD (9684037)\n    Health Status:      Healthy\n\n    GROUP  KIND        NAMESPACE  NAME                             STATUS  HEALTH   HOOK  MESSAGE\n        Service     default    cloudnativesampleapp-service     Synced  Healthy        service/cloudnativesampleapp-service created\n    apps   Deployment  default    cloudnativesampleapp-deployment  Synced  Healthy        deployment.apps/cloudnativesampleapp-deployment created\n    ```\n- Show application deployment history\n    ```bash\n    argocd app history sample\n    ```\n    ```\n    ID  DATE                           REVISION\n    0   2020-02-12 21:10:32 -0500 EST  HEAD (9684037)\n    ```\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n</Tabs>\n","type":"Mdx","contentDigest":"ded9c9af4b88f1bd64b54568bb8ade17","counter":586,"owner":"gatsby-plugin-mdx"},"exports":[],"rawBody":"---\ntitle: ArgoCD Lab\ndescription: Lab for continuous delivery using ArgoCD\n---\n\n<Tabs>\n<Tab label=\"OpenShift\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    oc new-project argocd\n    ```\n- Install ArgoCD as follows.\n    ```\n    oc apply --filename https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argocd-operator.yaml\n    ```\n- When installing the tutorial, make sure you wait until the argocd-operator is finished before installing the argocd-cr..or it will fail. You can do this:\n    ```bash\n    oc get ClusterServiceVersion -n argocd\n    NAME                                   DISPLAY                        VERSION   REPLACES   PHASE\n    argocd-operator.v0.0.8                 Argo CD                        0.0.8                Succeeded\n    ```\n    and wait for the \"succeeded\" to come up before proceeding.\n    ```\n    oc apply --filename https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argocd-cr.yaml\n    ```\n    and wait for the argocd server Pod to be running\n    ```\n    oc get pods -n argocd -l app.kubernetes.io/name=example-argocd-server\n    ```\n    ```\n    NAME                                     READY   STATUS    RESTARTS   AGE\n    example-argocd-server-57c4fd5c45-zf4q6   1/1     Running   0          115s\n    ```\n- Install the `argocd` CLI, for example on OSX use brew\n    ```bash\n    brew tap argoproj/tap\n    brew install argoproj/tap/argocd\n    ```\n- Set an environment variable `ARGOCD_URL` using the `EXTERNAL-IP`\n    ```bash\n    export ARGOCD_NAMESPACE=\"argocd\"\n    export ARGOCD_SERVER=$(oc get route example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.spec.host}')\n    export ARGOCD_URL=\"https://$ARGOCD_SERVER\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    echo ARGOCD_SERVER=$ARGOCD_SERVER\n    ```\n\n## Deploying the app\n\n- Login into the UI.\n    ```bash\n    open $ARGOCD_URL\n    ```\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    oc get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `openshift`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service route\n    ```\n    oc get route\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                 HOST/PORT                                     PATH   SERVICES                       PORT   TERMINATION   WILDCARD\n    cloudnative-sample   cloudnative-sample-default.apps-crc.testing          cloudnativesampleapp-service   9080                 None\n    ```\n- Set an environment variable `APP_URL` using the `EXTERNAL-IP`\n    ```\n    export APP_URL=\"http://$(oc get route cloudnative-sample -o jsonpath='{.status.ingress[0].host}')\"\n    echo ARGOCD_SERVER=$APP_URL\n    ```\n- Access the url using `curl`\n    ```\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## Using the ArgoCD CLI\n\n- Login using the cli.\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    export ARGOCD_PASSWORD=$(oc get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d)\n    echo $ARGOCD_PASSWORD\n    ```\n- Now login as follows.\n    ```bash\n    argocd login --username admin --password $ARGOCD_PASSWORD $ARGOCD_SERVER\n    ```\n    ```\n    WARNING: server certificate had error: x509: cannot validate certificate for 10.97.240.99 because it doesn't contain \n    any IP SANs. Proceed insecurely (y/n)? y\n\n    'admin' logged in successfully\n    Context 'example-argocd-server-argocd.apps-crc.testing' updated\n    ```\n- List the applications\n    ```bash\n    argocd app list\n    ```\n    ```\n    NAME    CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                                     PATH   TARGET\n    sample  https://kubernetes.default.svc  default    default  Synced  Healthy  <none>      <none>      https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy  openshift  HEAD\n    ```\n- Get application details\n    ```bash\n    argocd app get sample\n    ```\n    ```\n    Name:               sample\n    Project:            default\n    Server:             https://kubernetes.default.svc\n    Namespace:          default\n    URL:                https://10.97.240.99/applications/sample\n    Repo:               https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy\n    Target:             HEAD\n    Path:               openshift\n    SyncWindow:         Sync Allowed\n    Sync Policy:        <none>\n    Sync Status:        Synced to HEAD (9684037)\n    Health Status:      Healthy\n\n    GROUP  KIND        NAMESPACE  NAME                             STATUS  HEALTH   HOOK  MESSAGE\n        Service     default    cloudnativesampleapp-service     Synced  Healthy        service/cloudnativesampleapp-service created\n    apps   Deployment  default    cloudnativesampleapp-deployment  Synced  Healthy        deployment.apps/cloudnativesampleapp-deployment created\n    ```\n- Show application deployment history\n    ```bash\n    argocd app history sample\n    ```\n    ```\n    ID  DATE                           REVISION\n    0   2020-02-12 21:10:32 -0500 EST  HEAD (9684037)\n    ```\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n<Tab label=\"IKS\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    kubectl create namespace argocd\n    export ARGOCD_NAMESPACE=argocd\n    ```\n- Create RBAC resources\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/service_account.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role_binding.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/ibm-cloud-architecture/learning-cloudnative-101/master/static/yamls/argo-lab/argo-clusteradmin.yaml\n    ```\n\n- Install CRDs\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_applications_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_appprojects_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocdexports_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocds_crd.yaml\n    ```\n    Verify CRDs\n    ```bash\n    kubectl get crd -n argocd\n    ```\n    ```\n    NAME                        CREATED AT\n    applications.argoproj.io    2020-05-15T02:05:55Z\n    appprojects.argoproj.io     2020-05-15T02:05:56Z\n    argocdexports.argoproj.io   2020-05-15T02:08:21Z\n    argocds.argoproj.io         2020-05-15T02:08:21Z\n    ```\n- Deploy Operator\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/operator.yaml\n    ```\n- Deploy ArgoCD CO\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/examples/argocd-lb.yaml\n    ```\n    Verify that ArgoCD Pods are running\n    ```bash\n    kubectl get pods -n argocd\n    ```\n    ```\n    NAME                                                     READY   STATUS    RESTARTS   AGE\n    argocd-operator-5f7d8cf7d8-486vn                         1/1     Running   0          3m46s\n    example-argocd-application-controller-7dc5fcb75d-xkk5h   1/1     Running   0          2m3s\n    example-argocd-dex-server-bb9df96cb-ndmhl                1/1     Running   0          2m3s\n    example-argocd-redis-756b6764-sb2gt                      1/1     Running   0          2m3s\n    example-argocd-repo-server-75944fcf87-zmh48              1/1     Running   0          2m3s\n    example-argocd-server-747b684c8c-xhgl9                   1/1     Running   0          2m3s\n    ```\n    Verify that the other ArgoCD resources are created\n    ```\n    kubectl get cm,secret,svc,deploy -n argocd\n    ```\n- List the argocd-server service\n    ```bash\n    kubectl get svc example-argocd-server -n argocd\n    ```\n\n- From the script, the Argo Server service has a `type` of `LoadBalancer`. If the `ExternalIP` is in a `pending` state, then there is no loadBalancer for your cluster, so we only need the the ArgoCD server's `NodePort`. Otherwise use the `ExternalIP` and `NodePort` to access Argo.\n    ```\n    NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE\n    example-argocd-server   LoadBalancer   10.105.73.245   <pending>   80:31138/TCP,443:31932/TCP   5m3s\n    ```\n\n- To access the service we need the `Node's External IP` and the `NodePort`. Let's set an environment variable `ARGOCD_URL` with `NODE_EXTERNAL_IP`:`NodePort`.\n    ```bash\n    export NODE_EXTERNAL_IP=\"$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"ExternalIP\")].address}')\"\n    export ARGOCD_NODEPORT=\"$(kubectl get svc example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.spec.ports[0].nodePort}')\"\n    export ARGOCD_URL=\"https://$NODE_EXTERNAL_IP:$ARGOCD_NODEPORT\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    ```\n\n- If you can't access the NodePort from your computer and only http/80 then edit the argocd-server and add the flag `--insecure`\n    ```bash\n    kubectl edit -n argocd deployment example-argocd-server\n    ```\n    Use the kube api to proxy into the argocd server using `kubectl port-forward`\n    ```\n    kubectl port-forward service/example-argocd-server 8080:80 -n argocd\n    ```\n    Then you can access the argocd server locally on port 8080 [http://localhost:8080](http://localhost:8080)\n\n## Deploying the app\n\n- Login using the Browser into the UI using `$ARGOCD_URL` or `localhost:8080` if using port-forward\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `kubernetes`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service service\n    ```bash\n    kubectl get svc cloudnativesampleapp-service\n    ```\n    It will have the `NodePort` for the application. In this case, it is `30499`. \n    ```\n    NAME                           TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE\n    cloudnativesampleapp-service   NodePort   172.21.118.165   <none>        9080:30499/TCP   20s\n    ```\n- Set an environment variable `APP_URL` using the `Node's IP` and `NodePort` values\n    ```bash\n    export APP_NODE_PORT=\"$(kubectl get svc cloudnativesampleapp-service -n default -o jsonpath='{.spec.ports[0].nodePort}')\"\n    export APP_URL=\"$NODE_EXTERNAL_IP:$APP_NODE_PORT\"\n    echo Application=$APP_URL\n    ```\n- Access the url using `curl`\n    ```bash\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n<Tab label=\"Minikube\">\n\n## Pre-requisites\n\nMake sure your environment is setup properly for the lab.\n\nCheck the [Environment Setup](../prerequisites/#environment-setup) page for your setup.\n\n- Install the `argocd` CLI, for example on OSX use brew\n    ```bash\n    brew tap argoproj/tap\n    brew install argoproj/tap/argocd\n    ```\n\n- Remember to have minikube tunnel running in another terminal\n    ```bash\n    minikube tunnel\n    ```\n\n## ArgoCD Installation\n\n- Create the namespace `argocd` to install argocd\n    ```bash\n    kubectl create namespace argocd\n    ```\n- Create RBAC resources\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/service_account.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/role_binding.yaml\n    ```\n    Create ClusterRoleBinding for `cluster-admin` role for `sa` `argocd-application-controller` in namespace `argocd`\n    ```bash\n    cat <<'EOF' | kubectl create -f -\n    apiVersion: rbac.authorization.k8s.io/v1\n    kind: ClusterRoleBinding\n    metadata:\n      labels:\n        app.kubernetes.io/component: application-controller\n        app.kubernetes.io/name: argocd-application-controller\n        app.kubernetes.io/part-of: argocd\n      name: argocd-application-controller\n    roleRef:\n      apiGroup: rbac.authorization.k8s.io\n      kind: ClusterRole\n      name: cluster-admin\n    subjects:\n      - kind: ServiceAccount\n        name: argocd-application-controller\n        namespace: argocd\n    EOF\n    ```\n- Install CRDs\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_applications_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/argo-cd/argoproj.io_appprojects_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocdexports_crd.yaml\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/crds/argoproj.io_argocds_crd.yaml\n    ```\n    Verify CRDs\n    ```bash\n    kubectl get crd -n argocd\n    ```\n    ```\n    NAME                        CREATED AT\n    applications.argoproj.io    2020-05-15T02:05:55Z\n    appprojects.argoproj.io     2020-05-15T02:05:56Z\n    argocdexports.argoproj.io   2020-05-15T02:08:21Z\n    argocds.argoproj.io         2020-05-15T02:08:21Z\n    ```\n- Deploy Operator\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/deploy/operator.yaml\n    ```\n- Deploy ArgoCD CO\n    ```bash\n    kubectl create -n argocd -f https://raw.githubusercontent.com/argoproj-labs/argocd-operator/v0.0.8/examples/argocd-lb.yaml\n    ```\n    Verify that ArgoCD Pods are running\n    ```bash\n    kubectl get pods -n argocd\n    ```\n    ```\n    NAME                                                     READY   STATUS    RESTARTS   AGE\n    argocd-operator-5f7d8cf7d8-486vn                         1/1     Running   0          3m46s\n    example-argocd-application-controller-7dc5fcb75d-xkk5h   1/1     Running   0          2m3s\n    example-argocd-dex-server-bb9df96cb-ndmhl                1/1     Running   0          2m3s\n    example-argocd-redis-756b6764-sb2gt                      1/1     Running   0          2m3s\n    example-argocd-repo-server-75944fcf87-zmh48              1/1     Running   0          2m3s\n    example-argocd-server-747b684c8c-xhgl9                   1/1     Running   0          2m3s\n    ```\n    Verify that the other ArgoCD resources are created\n    ```\n    kubectl get cm,secret,svc,deploy -n argocd\n    ```\n- Expose the ArgoCD Server service as a NodePort.\n    ```bash\n    kubectl expose deployment.apps/example-argocd-server --type=\"NodePort\" --port 8080 --name=argo-nodeport -n argocd  \n    ```\n- List the argocd-server service\n    ```bash\n    kubectl get svc example-argocd-server -n argocd\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE\n    example-argocd-server   LoadBalancer   172.21.106.88   <pending>     80:32010/TCP,443:31861/TCP   111m\n    ```\n- Set an environment variable `ARGOCD_URL` using the `EXTERNAL-IP`\n    ```bash\n    export ARGOCD_NAMESPACE=argocd\n    export ARGOCD_SERVER=\"$(kubectl get svc example-argocd-server -n $ARGOCD_NAMESPACE -o jsonpath='{.status.loadBalancer.ingress[0].ip}')\"\n    export ARGOCD_URL=\"https://$ARGOCD_SERVER\"\n    echo ARGOCD_URL=$ARGOCD_URL\n    echo ARGOCD_SERVER=$ARGOCD_SERVER\n    ```\n\n## Deploying the app\n\n- Login into the UI.\n    ```bash\n    open $ARGOCD_URL\n    ```\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d\n    ```\n    For example the output is similar to this:\n    ```\n    tyafMb7BNvO0kP9eizx3CojrK8pYJFQq\n    ```\n\n![ArgoCD Login](./images/argocd_login.png)\n\n- Now go back to the ArgoCD home and click on `NEW APP`.\n- Add the below details:\n- Application Name: `sample`\n- Project - `default`\n- SYNC POLICY: `Manual`\n- REPO URL: `https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy`\n- Revision: `HEAD`\n- Path: `kubernetes`\n\n![app details one](./images/app_argo_1.png)\n\n- Cluster - Select the default one `https://kubernetes.default.svc` to deploy in-cluster\n- Namespace - `default`\n- Click Create to finish\n\n![app details two](./images/app_argo_2.png)\n\n- You will now see the available apps.\n\n![sampleapp create](./images/sampleapp_create.png)\n\n- Initially, the app will be out of sync. It is yet to be deployed. You need to sync it for deploying.\n\nTo sync the application, click `SYNC` and then `SYNCHRONIZE`.\n\n![out of sync](./images/out_of_sync.png)\n\n- Wait till the app is deployed.\n\n![synched app](./images/synched_app.png)\n\n- Once the app is deployed, click on it to see the details.\n\n![sample app deployed](./images/sample_app_deployed.png)\n\n![sample app full deployment](./images/sample_app_full_deployment.png)\n\n## Verifying the deployment\n\n- Access the app to verify if it is correctly deployed.\n- List the cloudnativesampleapp-service service\n    ```bash\n    kubectl get svc cloudnativesampleapp-service\n    ```\n    It should have an IP under `EXTERNAL-IP` column\n    ```\n    NAME                           TYPE           CLUSTER-IP       EXTERNAL-IP      PORT(S)          AGE\n    cloudnativesampleapp-service   NodePort       10.109.242.212   10.109.242.212   9080:31905/TCP   13m\n    ```\n- Set an environment variable `APP_URL` using the `EXTERNAL-IP` and `NodePort` values\n    ```bash\n    export APP_URL=\"$(minikube service --url cloudnativesampleapp-service -n default)\"\n    echo APP_URL=$APP_URL\n    ```\n- Access the url using `curl`\n    ```bash\n    curl \"$APP_URL/greeting?name=Carlos\"\n    ```\n    ```\n    {\"id\":2,\"content\":\"Welcome to Cloudnative bootcamp !!! Hello, Carlos :)\"}\n    ```\n\n## Using the ArgoCD CLI\n\n- Login using the cli.\n- Use `admin` as the username and get the password with the following command\n    ```bash\n    export ARGOCD_PASSWORD=$(kubectl get secret example-argocd-cluster -n $ARGOCD_NAMESPACE -o jsonpath='{.data.admin\\.password}' | base64 -d)\n    echo $ARGOCD_PASSWORD\n    ```\n- Now login as follows.\n    ```bash\n    argocd login --username admin --password $ARGOCD_PASSWORD $ARGOCD_SERVER\n    ```\n    ```\n    WARNING: server certificate had error: x509: cannot validate certificate for 10.97.240.99 because it doesn't contain \n    any IP SANs. Proceed insecurely (y/n)? y\n\n    'admin' logged in successfully\n    Context '10.105.73.245' updated\n    ```\n- List the applications\n    ```bash\n    argocd app list\n    ```\n    ```\n    NAME    CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                                     PATH   TARGET\n    sample  https://kubernetes.default.svc  default    default  Synced  Healthy  <none>      <none>      https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy  kubernetes  HEAD\n    ```\n- Get application details\n    ```bash\n    argocd app get sample\n    ```\n    ```\n    Name:               sample\n    Project:            default\n    Server:             https://kubernetes.default.svc\n    Namespace:          default\n    URL:                https://10.97.240.99/applications/sample\n    Repo:               https://github.com/ibm-cloud-architecture/cloudnative_sample_app_deploy\n    Target:             HEAD\n    Path:               kubernetes\n    SyncWindow:         Sync Allowed\n    Sync Policy:        <none>\n    Sync Status:        Synced to HEAD (9684037)\n    Health Status:      Healthy\n\n    GROUP  KIND        NAMESPACE  NAME                             STATUS  HEALTH   HOOK  MESSAGE\n        Service     default    cloudnativesampleapp-service     Synced  Healthy        service/cloudnativesampleapp-service created\n    apps   Deployment  default    cloudnativesampleapp-deployment  Synced  Healthy        deployment.apps/cloudnativesampleapp-deployment created\n    ```\n- Show application deployment history\n    ```bash\n    argocd app history sample\n    ```\n    ```\n    ID  DATE                           REVISION\n    0   2020-02-12 21:10:32 -0500 EST  HEAD (9684037)\n    ```\n## References\n\n- [ArgoCD](https://argoproj.github.io/argo-cd/)\n\n</Tab>\n\n</Tabs>\n","frontmatter":{"title":"ArgoCD Lab","description":"Lab for continuous delivery using ArgoCD"},"fileAbsolutePath":"/home/travis/build/ibm-cloud-architecture/learning-cloudnative-101/src/pages/lectures/continuous-deployment/activities/index.mdx"}}},"staticQueryHashes":["1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","63531786","63531786","768070550"]}